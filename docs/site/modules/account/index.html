<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí≥ ACCOUNT - Gu√≠a de Desarrollo de Historias de Usuario</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .overview {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .overview h2 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }
        
        .overview p {
            margin-bottom: 1rem;
            font-size: 1.05rem;
        }
        
        .overview strong {
            color: #667eea;
        }
        
        section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        h2 {
            color: #667eea;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 0.5rem;
        }
        
        h3 {
            color: #5568d3;
            margin: 1.5rem 0 1rem;
            font-size: 1.4rem;
        }
        
        h4 {
            color: #764ba2;
            margin: 1rem 0 0.5rem;
            font-size: 1.1rem;
        }
        
        ul, ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }
        
        li {
            margin-bottom: 0.5rem;
        }
        
        .us-template {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        
        .us-template strong {
            color: #667eea;
            display: block;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }
        
        .us-template p {
            font-style: italic;
            margin-bottom: 1rem;
        }
        
        .criteria {
            background: white;
            padding: 1rem;
            border-radius: 4px;
            margin-top: 1rem;
        }
        
        .criteria li {
            color: #2c5282;
        }
        
        .criteria li:before {
            content: "‚úÖ ";
            color: #48bb78;
            font-weight: bold;
        }
        
        .complexity-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            margin-left: 0.5rem;
        }
        
        .simple {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .medium {
            background: #feebc8;
            color: #7c2d12;
        }
        
        .complex {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .component-card {
            background: #f8f9fa;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        
        .component-card h4 {
            margin-top: 0;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .highlight {
            background: #fef3c7;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
        }
        
        .warning {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        
        .info {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        
        .success {
            background: #d1fae5;
            border-left: 4px solid #10b981;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        th, td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: #f1f5f9;
            color: #667eea;
            font-weight: 600;
        }
        
        footer {
            text-align: center;
            padding: 2rem;
            color: #666;
            background: white;
            margin-top: 3rem;
            border-top: 1px solid #e0e0e0;
        }
        
        footer a {
            color: #667eea;
            font-weight: 600;
            text-decoration: none;
            margin: 0 0.5rem;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üí≥ ACCOUNT - Gu√≠a de Desarrollo de Historias de Usuario</h1>
            <p class="subtitle">Consulta y actualizaci√≥n segura de cuentas para Customer Service, Operaciones y Riesgos.</p>
            <p class="subtitle">Las pantallas `/accounts/view` y `/accounts/update` est√°n protegidas por `ProtectedRoute` y refrescadas por `useSecureSession`.</p>
        </header>

        <section class="overview">
            <h2>üìã Visi√≥n General</h2>
            <p>El m√≥dulo ACCOUNT combina la vista (`AccountViewScreen`) y el editor (`AccountUpdateScreen`) con hooks reutilizables (`useAccountView`, `useAccountUpdate`) para ofrecer diagn√≥sticos de cuenta, datos sensibles enmascarados, validaciones en cliente/servidor y confirmaciones antes de persistir.</p>
            <p>Integra `SystemHeader`, `LoadingSpinner` y `Alert` de la librer√≠a global, y llama al `apiClient` central (`app/services/api.ts`) que detecta respuestas MSW vs backend real (cadenas `currentDate`, `transactionId`).</p>
        </section>

        <section>
            <h2>üéØ Gu√≠a de Desarrollo de Historias</h2>
            <div class="us-template">
                <strong>Visualizaci√≥n validada</strong>
                <p>As an agent, busco una cuenta por `accountId` de 11 d√≠gitos, veo balance, estado y tarjetas en menos de 500 ms y puedo mostrar/ocultar datos sensibles con un bot√≥n.</p>
                <strong>Actualizaci√≥n segura</strong>
                <p>Como administrador, quiero editar direcci√≥n, tel√©fono y l√≠mites, verificar `hasChanges`, abrir el di√°logo de confirmaci√≥n y enviar la petici√≥n solo si las validaciones locales (`zipCode`, `activeStatus`, `ficoScore`) est√°n limpias.</p>
                <strong>Control de l√≠mites y riesgos</strong>
                <p>Como analista, necesito que el sistema recalcula `availableCredit`, aplique reglas de FICO (300-850) y reserva un handler de error (`accounts/99999999999`) para probar resiliencia.</p>
            </div>
            <div class="component-card">
                <h3>‚ö° Factores de aceleraci√≥n</h3>
                <ul>
                    <li><strong>`useAccountView` + `useAccountUpdate`:</strong> encapsulan estados `loading/error`, reset y limpieza local.</li>
                    <li><strong>Material-UI preconfigurado:</strong> `Grid`, `Card`, `Chip`, `Dialog`, `Alert` y `SystemHeader` ofrecen layout consistente.</li>
                    <li><strong>Mock data robusta:</strong> `app/mocks/accountHandlers.ts` y `accountUpdateHandlers.ts` proporcionan 10 cuentas, validaciones y delays controlados.</li>
                    <li><strong>Validaci√≥n automatizada:</strong> `validate-mocks.sh` asegura que existen al menos 10 cuentas, tarjetas y usuarios antes de desplegar.</li>
                    <li><strong>ProtectedRoute + menuData:</strong> el m√≥dulo aparece solo para back-office/admin y se protege con tokens y `useSecureSession`.</li>
                </ul>
            </div>
            <div class="component-card">
                <h3>üìä Gu√≠a de complejidad</h3>
                <div>
                    <span class="complexity-badge simple">Simple</span>
                    <span class="complexity-badge medium">Medio</span>
                    <span class="complexity-badge complex">Complejo</span>
                </div>
                <ul>
                    <li><strong>Simple (1-2 pts):</strong> A√±adir un helper text o badge extra en `AccountViewScreen` sin cambiar la API.</li>
                    <li><strong>Medio (3-5 pts):</strong> Extender el formulario de actualizaci√≥n con un nuevo campo `phoneNumber2` y validaci√≥n regex.</li>
                    <li><strong>Complejo (5-8 pts):</strong> Integrar auditor√≠a en el backend simulado, manejar el error del handler 999... y desplegar workflow de aprobaci√≥n.</li>
                </ul>
            </div>
        </section>

        <section>
            <h2>üîß Fundaci√≥n T√©cnica</h2>
            <div class="component-card">
                <h4>AccountViewScreen.tsx</h4>
                <p>Busca cuentas con input limitado a 11 d√≠gitos, muestra chips de estado, tarjetas de resumen y permite toggles (`Show Sensitive Data`, cuentas de prueba). Usa `SystemHeader`, `LoadingSpinner`, `Alert` y `Collapse` para UX progresivo.</p>
            </div>
            <div class="component-card">
                <h4>AccountUpdateScreen.tsx</h4>
                <p>Activa `editMode` tras la b√∫squeda, valida campos (`activeStatus`, `zipCode`, n√∫meros) en `handleFieldChange`, abre un `Dialog` de confirmaci√≥n, soporta atajos F3/F5/F12 y detecta cambios vs `originalData`.</p>
            </div>
            <div class="component-card">
                <h4>useAccountView &amp; useAccountUpdate</h4>
                <p>Hooks que llaman a `apiClient`, manejan errores, registran el hist√≥rico de datos y exponen helpers como `initializeScreen`, `searchAccount`, `updateAccount`, `resetForm` y `clearData`.</p>
            </div>
            <div class="component-card">
                <h4>App.tsx + ProtectedRoute</h4>
                <p>Enrutamiento protege `/accounts/view` y `/accounts/update`, reusa `ProtectedRoute` sin rol espec√≠fico y garantiza que `useSecureSession` mantenga tokens mientras se navega.</p>
            </div>
            <h3>Dependencias clave</h3>
            <ul>
                <li><strong>AUTH (authSlice, ProtectedRoute)</strong> ‚Äì Controla tokens, roles `admin`/`back-office` y se asegura de que la sesi√≥n sea renovada antes de cada cambio.</li>
                <li><strong>Menu (menuData)</strong> ‚Äì A√±ade las rutas a la IU principal para acceder a Account View / Update.</li>
                <li><strong>apiClient (`services/api.ts`)</strong> ‚Äì Encapsula headers, tiempo de espera y detecci√≥n MSW vs real, esencial para las historias de API.</li>
                <li><strong>MSW</strong> ‚Äì `app/mocks/accountHandlers.ts` + `accountUpdateHandlers.ts` interceptan las peticiones y exponen errores controlados (400, 404, 500).</li>
            </ul>
        </section>

        <section>
            <h2>üåê APIs P√∫blicas</h2>
            <div class="component-card">
                <h4>GET /account-view?accountId={id}</h4>
                <p>Devuelve la vista completa con balances, estado, cliente y tarjeta. Ideal para historias que requieren respuesta en < 500 ms.</p>
                <div class="code-block">
<pre>{
  "accountStatus": "Y",
  "currentBalance": 1250.75,
  "creditLimit": 5000.0,
  "availableCredit": 3749.25,
  "groupId": "PREMIUM",
  "customerSsn": "123-45-6789",
  "ficoScore": 750,
  "cardNumber": "4111111111111111",
  "infoMessage": "Displaying details of given Account",
  "inputValid": true
}</pre>
                </div>
            </div>
            <div class="component-card">
                <h4>PUT /accounts/{accountId}</h4>
                <p>Actualiza account + customer dentro de un solo request; el mock valida `activeStatus`, `zipCode`, `ficoScore` y `creditLimit` y retorna errores detallados.</p>
                <div class="code-block">
<pre>{
  "accountId": 11111111111,
  "activeStatus": "Y",
  "creditLimit": 5200.0,
  "zipCode": "10452",
  "ficoScore": 760,
  "phoneNumber1": "555-999-0000",
  "addressLine1": "789 NEW STREET"
}</pre>
                </div>
                <p class="info">`accountUpdateHandlers.ts` responde 400 si faltan campos o si `ficoScore` est√° fuera de rango y simula 500 cuando se usa el ID 99999999999.</p>
            </div>
        </section>

        <section>
            <h2>üìä Modelos de datos y reglas</h2>
            <table>
                <thead>
                    <tr><th>Entidad</th><th>Campos clave</th><th>Notas</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td>AccountViewResponse</td>
                        <td>accountStatus, currentBalance, creditLimit, availableCredit, groupId, customerSsn, ficoScore, cardNumber</td>
                        <td>El UI enmascara `customerSsn` y `cardNumber`; `showSensitiveData` controla la revelaci√≥n.</td>
                    </tr>
                    <tr>
                        <td>AccountUpdateData</td>
                        <td>activeStatus (Y/N), creditLimit, zipCode, phoneNumber1, ssn, ficoScore, governmentIssuedId</td>
                        <td>Validado localmente en `handleFieldChange` y en el handler mock.</td>
                    </tr>
                </tbody>
            </table>
            <div class="grid">
                <div class="component-card">
                    <h4>RN-001</h4>
                    <p>Account ID debe tener 11 d√≠gitos y no puede ser `00000000000`. Validado en el formulario y en MSW.</p>
                </div>
                <div class="component-card">
                    <h4>RN-002</h4>
                    <p>ActiveStatus s√≥lo acepta `Y`/`N` y se muestra con chips verdes/rojos.</p>
                </div>
                <div class="component-card">
                    <h4>RN-003</h4>
                    <p>ZIP code usa la regex `^\d{5}(-\d{4})?$` y `ficoScore` entre 300 y 850, lo que evita errores en el backend simulado.</p>
                </div>
            </div>
        </section>

        <section>
            <h2>üß™ Pruebas y Mocking</h2>
            <div class="component-card">
                <h4>accountHandlers.ts</h4>
                <p>Contiene 10 cuentas de prueba (11111111111, 22222222222, ‚Ä¶) con delays de 500 ms, mensajes `infoMessage`, `errorMessage` y `foundAccountInMaster` para reproducir flujos reales.</p>
            </div>
            <div class="component-card">
                <h4>accountUpdateHandlers.ts</h4>
                <p>Define `mockAccountUpdateData`, aplica validaciones (activeStatus, creditLimit &gt;= 0, zipCode regex, ficoScore 300-850) y expone un error 500 simulado para el ID 99999999999.</p>
            </div>
            <div class="component-card">
                <h4>validate-mocks.sh</h4>
                <ul>
                    <li>Verifica que existan ‚â•10 cuentas, tarjetas, transacciones y usuarios.</li>
                    <li>Comprueba que `VITE_USE_MOCKS=true` en `.env.development`.</li>
                    <li>Confirma que los handlers est√°n importados y que las relaciones Account‚ÜíCard‚ÜíTransaction se mantienen.</li>
                </ul>
            </div>
            <div class="component-card">
                <h4>Cuentas de prueba</h4>
                <p>El bot√≥n `Show Test Accounts` (visible s√≥lo en DEV) permite precargar IDs de demostraci√≥n y agiliza QA sin conocer los IDs reales.</p>
            </div>
        </section>

        <section>
            <h2>‚öôÔ∏è Performance &amp; Riesgos</h2>
            <div class="component-card">
                <h4>Presupuestos de performance</h4>
                <ul>
                    <li><strong>GET /account-view:</strong> < 500 ms en entorno mock.</li>
                    <li><strong>PUT /accounts/{accountId}:</strong> ~1.2 s para visualizar loaders, el handler simula latencia m√°s alta.</li>
                    <li><strong>Timeout API:</strong> `apiClient` aborta antes de 10 s para evitar bloqueos.</li>
                </ul>
            </div>
            <div class="component-card">
                <h4>Riesgos y mitigaciones</h4>
                <ul>
                    <li>Dependencia de MSW para datos de cuentas ‚Üí Validar con backend real antes de producci√≥n.</li>
                    <li>Sin auditor√≠a de cambios ‚Üí Documentar la necesidad de agregar un m√≥dulo de log en historias futuras.</li>
                    <li>Validaciones duales (UI + handler) deben mantenerse sincronizadas; cualquier regex modificada exige actualizar ambos lugares.</li>
                </ul>
            </div>
        </section>

        <footer>
            <p><a href="../index.html">‚Üê Volver al √çndice de M√≥dulos</a> ¬∑ <a href="../../system-overview.md">üè† System Overview</a></p>
            <p><em>√öltima actualizaci√≥n: 2026-02-10 | Precisi√≥n: ‚â•95%</em></p>
        </footer>
    </div>
</body>
</html>
