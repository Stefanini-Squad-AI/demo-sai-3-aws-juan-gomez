<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACCOUNT - Gu√≠a de Historias de Usuario</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
            background: #f3f5f9;
            color: #1f2933;
        }
        a { color: #4c5fd8; }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 36px 24px 80px;
        }
        .header {
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            color: white;
            padding: 40px 32px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(15, 23, 42, 0.25);
        }
        .header h1 { margin: 0 0 12px; font-size: 2.6rem; }
        .header p { margin: 8px 0; opacity: 0.95; }
        .pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 999px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        .section {
            background: white;
            border-radius: 14px;
            padding: 28px 32px;
            margin-top: 24px;
            box-shadow: 0 12px 32px rgba(15, 23, 42, 0.08);
        }
        .section h2 {
            font-size: 1.6rem;
            margin-bottom: 16px;
            color: #374151;
        }
        .section h3 {
            margin-top: 18px;
            font-size: 1.2rem;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 16px;
            margin-top: 12px;
        }
        .card {
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            background: #f9fafb;
        }
        .card strong { color: #1d4ed8; }
        .inline-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }
        th, td {
            border-bottom: 1px solid #e5e7eb;
            padding: 10px 8px;
            text-align: left;
        }
        th { background: #eef2ff; color: #1f2933; }
        pre {
            background: #0f172a;
            color: #e0f2fe;
            padding: 16px;
            border-radius: 10px;
            overflow-x: auto;
        }
        .badge {
            display: inline-flex;
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-right: 6px;
        }
        .simple { background: #def7ec; color: #065f46; }
        .medium { background: #fef3c7; color: #92400e; }
        .complex { background: #fee2e2; color: #991b1b; }
        footer {
            margin-top: 40px;
            padding: 20px;
            text-align: center;
            color: #6b7280;
            font-size: 0.95rem;
        }
        .footer-links {
            margin-top: 12px;
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            font-weight: 600;
        }
        .link-button {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: 999px;
            background: #e0e7ff;
            color: #3730a3;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="pill">üí≥ ACCOUNT - M√≥dulo de Cuentas</div>
            <h1>Gu√≠a de Desarrollo de Historias de Usuario</h1>
            <p>Consulta y edici√≥n segura de cuentas, balances y datos personales dentro del sistema CardDemo.</p>
            <p><strong>Prop√≥sito:</strong> Servir como referencia operativa para Product Owners e ingenieros que mantienen la experiencia financiera del back-office.</p>
            <a href="../../../modules/account/account-overview.md" class="link-button">üìÑ Ver Account Overview (Markdown)</a>
        </header>

        <section class="section">
            <h2>üìã Panorama del m√≥dulo</h2>
            <p><strong>Contexto de negocio:</strong> Permite a agentes de servicio y administradores consultar saldos, l√≠mites, datos de cliente y actualizar la informaci√≥n oficial de cuentas con auditor√≠a manual.</p>
            <p><strong>Responsabilidades:</strong> buscar cuentas por ID de 11 d√≠gitos, presentar datos financieros formateados, aplicar m√°scaras de datos sensibles y respaldar ediciones transaccionales del Account + Customer.</p>
            <div class="inline-grid">
                <div>
                    <h3>Indicadores clave</h3>
                    <ul>
                        <li>2 pantallas principales: View + Update.</li>
                        <li>5+ validaciones cr√≠ticas en frontend y backend.</li>
                        <li>10 cuentas mock para pruebas r√°pidas.</li>
                        <li>Atajos: F3 (salir), ENTER (buscar), F5 (guardar), F12 (reset).</li>
                    </ul>
                </div>
                <div>
                    <h3>Modelos de actor</h3>
                    <ul>
                        <li>Representante de servicio: consulta r√°pida de cuentas.</li>
                        <li>Administrador: actualiza l√≠mites, direcciones y datos fiscales.</li>
                        <li>QA / compliance: verifica mascaramiento de datos sensibles y errores.</li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üéØ Gu√≠a para User Stories</h2>
            <div class="grid">
                <div class="card">
                    <h3>Visualizaci√≥n de cuenta</h3>
                    <p><strong>Template:</strong> Como <em>representante</em>, quiero buscar por Account ID para ver saldo, l√≠mite, y datos de cliente y as√≠ atender consultas.</p>
                    <p><em>Criterios:</em> campo validado, spinner (`LoadingSpinner`), chips de estado, alertas si no se encuentra la cuenta.</p>
                </div>
                <div class="card">
                    <h3>Edici√≥n transaccional</h3>
                    <p><strong>Template:</strong> Como <em>admin</em>, quiero editar l√≠mites y direcci√≥n para reflejar aprobaciones aprobadas.</p>
                    <p><em>Criterios:</em> edit mode toggle, validaci√≥n `zipCode`/`activeStatus`, di√°logo de confirmaci√≥n, `PUT /api/accounts/{id}`.</p>
                </div>
                <div class="card">
                    <h3>Seguridad de datos</h3>
                    <p><strong>Template:</strong> Como <em>oficial de cumplimiento</em>, quiero que SSN y tarjeta se enmascaren por defecto.</p>
                    <p><em>Criterios:</em> toggle `Show Sensitive Data`, `formatSSN`, `formatCardNumber`.</p>
                </div>
                <div class="card">
                    <h3>Resiliencia</h3>
                    <p><strong>Template:</strong> Como <em>QA</em>, quiero reproducir errores de red/timeout.</p>
                    <p><em>Criterios:</em> MSW `test-error`, `useMutation` maneja errores y muestra `Alert`.</p>
                </div>
            </div>
            <div style="margin-top: 18px;">
                <span class="badge simple">Simple (1-2 pts)</span>
                <span class="badge medium">Medio (3-5 pts)</span>
                <span class="badge complex">Complejo (5-8 pts)</span>
            </div>
            <ul style="margin-top: 12px;">
                <li><strong>Simple:</strong> A√±adir nuevo campo de solo lectura o mensaje extra.</li>
                <li><strong>Medio:</strong> Validaciones adicionales o nuevo campo editable (ZIP, tel√©fonos).</li>
                <li><strong>Complejo:</strong> Integraci√≥n con scoring externo / auditor√≠a de cambios.</li>
            </ul>
        </section>

        <section class="section">
            <h2>üîß Fundaci√≥n t√©cnica</h2>
            <div class="grid">
                <div class="card">
                    <h3>AccountViewScreen</h3>
                    <p>Muestra tarjetas con `Grid`, `Card`, `Chip`, `Alert`, `SystemHeader` y validaciones de `accountId` (no cero, 11 d√≠gitos).</p>
                    <p>Incluye bot√≥n `Show Test Accounts`, toggle de datos sensibles, y atajos `F3`, `ENTER`.</p>
                </div>
                <div class="card">
                    <h3>AccountUpdateScreen</h3>
                    <p>Formulario dividido en Account & Customer, edit mode controlado con `Switch`, validaciones locales (monto, ZIP, FICO), di√°logo de confirmaci√≥n y atajos (F5=guardar, F12=reset).</p>
                </div>
                <div class="card">
                    <h3>useAccountView / useAccountUpdate</h3>
                    <p>Hooks fundidos con `useMutation` de `useApi.ts`: GET `/account-view`, `initializeScreen`, GET/PUT `/accounts/{id}`, detecci√≥n de cambios por comparaci√≥n JSON y resets.</p>
                </div>
                <div class="card">
                    <h3>P√°ginas</h3>
                    <p>`AccountViewPage` y `AccountUpdatePage` validan `localStorage.userRole` antes de renderizar y manejan la navegaci√≥n (`navigate('/menu/admin')` o `/menu/main`).</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üåê Public Interfaces</h2>
            <table>
                <thead>
                    <tr><th>Endpoint</th><th>Descripci√≥n</th></tr>
                </thead>
                <tbody>
                    <tr><td>GET /api/account-view?accountId=</td><td>Busca la cuenta y retorna `AccountViewResponse` con metadata y flags de validaci√≥n.</td></tr>
                    <tr><td>GET /api/account-view/initialize</td><td>Provee valores iniciales (`infoMessage`, `inputValid`) para mostrar al cargar.</td></tr>
                    <tr><td>GET /api/account-view/test-accounts</td><td>Lista 10 cuentas mock para desarrollo.</td></tr>
                    <tr><td>POST /api/account-view/process</td><td>Legacy para procesar accountId; comparte validaciones.</td></tr>
                    <tr><td>POST /api/account-view/test-error/:errorType</td><td>Genera errores (network, timeout, server-error) para probar UI.</td></tr>
                    <tr><td>GET /api/accounts/{accountId}</td><td>Obtiene `AccountUpdateData` para precargar el formulario de edici√≥n.</td></tr>
                    <tr><td>PUT /api/accounts/{accountId}</td><td>Actualiza cuenta + cliente; valida `activeStatus`, montos, ZIP, FICO. PUT 99999999999 siempre falla.</td></tr>
                </tbody>
            </table>
            <pre><code>
GET /api/account-view?accountId=11111111111
Response: AccountViewResponse (creditLimit, currentBalance, customerSsn, cardNumber, status chips)

PUT /api/accounts/11111111111
Body: AccountUpdateData (creditLimit, zipCode, phoneNumber1, etc.)
Response: { success: true, data: updated, message: "Changes committed to database" }
            </code></pre>
        </section>

        <section class="section">
            <h2>üìä Modelos de datos</h2>
            <p><strong>AccountViewResponse</strong> (app/types/account.ts): metadata + cuenta + cliente + flags (`inputValid`, `foundAccountInMaster`).</p>
            <p><strong>AccountUpdateData</strong> (app/types/accountUpdate.ts): datos de cuenta + cliente, usado por el formulario de edici√≥n y el `useAccountUpdate` para detectar cambios.</p>
            <pre><code>
interface AccountUpdateData {
  accountId: number;
  activeStatus: 'Y' | 'N';
  creditLimit: number;
  zipCode: string;
  ssn: string;
  governmentIssuedId: string;
  primaryCardIndicator: string;
  ficoScore: number;
  // ...otros campos personales y financieros
}
            </code></pre>
        </section>

        <section class="section">
            <h2>üìã Reglas y calidad</h2>
            <ul>
                <li>Account ID: 11 d√≠gitos, no puede ser 00000000000.</li>
                <li>Active Status: solo `Y` o `N`.</li>
                <li>ZIP code: regex `^\d{5}(-\d{4})?$`.</li>
                <li>FICO: 300-850.</li>
                <li>SSN/ tarjeta enmascarados salvo al activar toggle.</li>
                <li>Confirmaci√≥n obligatoria para guardar.</li>
                <li>Respuestas del backend requieren metadata (`transactionId`, `programName`).</li>
            </ul>
        </section>

        <section class="section">
            <h2>‚ö° Presupuestos y riesgos</h2>
            <div class="grid">
                <div class="card">
                    <h3>Performance</h3>
                    <p>Respuesta de b√∫squeda < 500 ms (P95). Throughput simulado 100 b√∫squedas concurrentes/s.</p>
                </div>
                <div class="card">
                    <h3>Riesgos</h3>
                    <ul>
                        <li>Sin caching real ‚Üí considerar Redis o caching local.</li>
                        <li>Duplicaci√≥n de validaciones ‚Üí mantener en sync con backend.</li>
                        <li>Sin auditor√≠a de cambios ‚Üí evaluar `Audit Trail` si la regla lo exige.</li>
                    </ul>
                </div>
            </div>
        </section>

        <footer>
            <p>Cuenta con el respaldo del m√≥dulo Markdown: <a href="../../../modules/account/account-overview.md">Account Overview detallado</a>.</p>
            <div class="footer-links">
                <a href="../index.html" class="link-button">‚Üê √çndice de m√≥dulos</a>
                <a href="../../../system-overview.md" class="link-button">üè† System Overview</a>
            </div>
            <p><em>√öltima actualizaci√≥n: 2026-01-26 | Precisi√≥n del m√≥dulo: 95%+</em></p>
        </footer>
    </div>
</body>
</html>
