<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACCOUNT - Gu√≠a de Desarrollo de Historias</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 0; background: #f5f7fa; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #2b6cb0, #2c5282); color: white; padding: 40px 30px; border-radius: 12px; margin-bottom: 30px; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .header p { margin: 5px 0; }
        .section { background: white; margin: 20px 0; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
        .section h2 { color: #2b6cb0; border-bottom: 3px solid #2b6cb0; padding-bottom: 10px; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 18px; margin-top: 20px; }
        .card { border: 1px solid #e2e8f0; border-radius: 10px; padding: 20px; background: #f9fafb; }
        .card h3 { margin-top: 0; color: #2c5282; }
        .badge { display: inline-block; padding: 6px 14px; border-radius: 999px; font-size: 0.85rem; font-weight: 600; margin: 4px 6px 4px 0; }
        .badge.simple { background: #c6f6d5; color: #22543d; }
        .badge.medium { background: #faf089; color: #744210; }
        .badge.complex { background: #fed7d7; color: #822727; }
        ul { padding-left: 1.2rem; }
        pre { background: #1e1e2f; color: #f8fafc; padding: 16px; border-radius: 8px; overflow-x: auto; font-size: 0.95rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border-bottom: 1px solid #e2e8f0; text-align: left; }
        th { background: #2b6cb0; color: white; }
        footer { text-align: center; margin: 40px 0 20px; }
        footer a { color: #2b6cb0; text-decoration: none; font-weight: 600; }
    </style>
</head>
<body>
<div class="container">
    <header class="header">
        <h1>üí≥ ACCOUNT - M√≥dulo de Cuentas</h1>
        <p>Gu√≠a de Desarrollo de Historias de Usuario</p>
        <p><strong>Prop√≥sito:</strong> Consultar y actualizar informaci√≥n completa de cuentas y clientes con validaciones financieras y protecci√≥n de datos sensibles.</p>
        <p><strong>Contexto:</strong> Equipo de Customer Service y operaciones mantiene saldos, l√≠mites y datos personales del titular antes, durante y despu√©s de cambios regulatorios.</p>
    </header>

    <section class="section">
        <h2>üìã Visi√≥n General del M√≥dulo</h2>
        <p>Permite buscar una cuenta por Account ID (exactamente 11 d√≠gitos), visualizar balances, cr√©dito disponible, estado, clientes y tarjetas asociadas, y ejecutar actualizaciones transaccionales de direcci√≥n, tel√©fono y l√≠mites.</p>
        <p><strong>Responsabilidades clave:</strong></p>
        <ul>
            <li>B√∫squeda validada de cuentas y clientes (AccountViewScreen/AccountViewPage).</li>
            <li>Actualizaci√≥n segura con detecci√≥n de cambios (AccountUpdateScreen/AccountUpdatePage).</li>
            <li>Reutilizaci√≥n de hooks (`useAccountView`, `useAccountUpdate`) para manejar estados y errores.</li>
            <li>Validaci√≥n de reglas de negocio (AccountValidationService) antes de persistir.</li>
            <li>Protecci√≥n de datos sensibles (SSN y tarjetas enmascaradas).</li>
        </ul>
    </section>

    <section class="section">
        <h2>üéØ Gu√≠a de Desarrollo de Historias</h2>
        <div class="grid">
            <div class="card">
                <h3>üìÑ Templates de US</h3>
                <p><strong>Visualizaci√≥n completa:</strong> Como representante de servicio, quiero buscar una cuenta por su ID de 11 d√≠gitos para ver saldo, l√≠mite y tarjetas asociadas y responder consultas en menos de 500 ms.</p>
                <p><strong>Actualizaci√≥n de cliente:</strong> Como administrador de cuentas, quiero modificar direcci√≥n y tel√©fono sin desbloquear tarjetas para mantener datos frescos sin romper reglas de negocio.</p>
                <p><strong>Control de l√≠mites:</strong> Como analista de riesgos, quiero recalcular `availableCredit` y validar FICO antes de aprobar un nuevo l√≠mite.</p>
            </div>
            <div class="card">
                <h3>‚ö° Factores de aceleraci√≥n</h3>
                <ul>
                    <li><strong>`useAccountView` y `useAccountUpdate`:</strong> encapsulan `loading`, `error`, validaciones y reconcilian cambios.</li>
                    <li><strong>Componentes MUI:</strong> TextField, Card, Button y Snackbar ya alineados con el theme corporativo.</li>
                    <li><strong>AccountValidationService:</strong> reglas centralizadas (FICO, ZIP, Account ID) reducen duplicaci√≥n.</li>
                    <li><strong>APIs:** `/api/account/acccount` y `/api/account/update` est√°n definidos y mockeados en MSW.</li>
                    <li><strong>Servicios transaccionales:</strong> `AccountUpdateService` asegura rollback completo en fallos.</li>
                </ul>
            </div>
            <div class="card">
                <h3>üìä Gu√≠as de complejidad</h3>
                <div>
                    <span class="badge simple">Simple (1-2 pts)</span>
                    <span class="badge medium">Medio (3-5 pts)</span>
                    <span class="badge complex">Complejo (5-8 pts)</span>
                </div>
                <ul>
                    <li><strong>Simple:</strong> Agregar campo de solo lectura en AccountViewScreen o ajustar el texto de ayuda.</li>
                    <li><strong>Medio:</strong> A√±adir validaci√≥n de ZIP o tel√©fono, extender formularios de edici√≥n con validaciones client/server.</li>
                    <li><strong>Complejo:</strong> Integrar scoring externo, auditor√≠a completa de cambios o migrar a un nuevo servicio de customer data.</li>
                </ul>
            </div>
        </div>
    </section>

    <section class="section">
        <h2>üîß Fundaci√≥n T√©cnica</h2>
        <div class="grid">
            <div class="card">
                <h3>AccountViewScreen.tsx</h3>
                <p>Interfaz principal que muestra tarjetas con cuentas, clientes y m√©tricas de cr√©dito. Usa `maskSSN` y `maskCard` antes de mostrar datos.</p>
                <p>Se integra con `useAccountView` y `ProtectedRoute` para asegurar acceso de `admin`/`back-office`.</p>
            </div>
            <div class="card">
                <h3>AccountUpdateScreen.tsx</h3>
                <p>Formulario editable en modo toggle, detecta cambios por comparaci√≥n profunda y resume diferencias antes de enviar.</p>
                <p>Env√≠a los datos al hook `useAccountUpdate` y muestra confirmaci√≥n con Snackbar.</p>
            </div>
            <div class="card">
                <h3>useAccountView.ts</h3>
                <p>Hook que valida `accountId` (11 d√≠gitos, no cero), controla `loading/error/data` y expone `searchAccount` que invoca `GET /api/account/acccount`.</p>
            </div>
            <div class="card">
                <h3>useAccountUpdate.ts</h3>
                <p>Detecci√≥n de cambios, validaci√≥n preliminar y ejecuci√≥n de llamada PUT. Maneja errores transaccionales y notifica cuando el backend revierte.</p>
            </div>
            <div class="card">
                <h3>AccountValidationService.java</h3>
                <p>Reglas cr√≠ticas (FICO 300-850, ZIP regex `^\d{5}(-\d{4})?$`, accountId 11 d√≠gitos) que se reutilizan tanto en backend como en frontend.</p>
            </div>
            <div class="card">
                <h3>AccountUpdateService.java</h3>
                <p>Operaci√≥n transaccional @Transactional que bloquea `Account` y `Customer`, valida con `AccountValidationService` y persiste en un solo commit.</p>
            </div>
        </div>

        <h3>Dependencias clave</h3>
        <ul>
            <li><strong>AUTH:</strong> Requiere sesi√≥n con roles `admin`/`back-office` y `ProtectedRoute`.</li>
            <li><strong>MENU:</strong> Expone la tarjeta de ACCOUNT en el men√∫ principal.</li>
            <li><strong>CREDIT CARD:</strong> Comparte utilidades de mascarado de n√∫mero, y depende de `cards` en la respuesta.</li>
            <li><strong>TRANSACTION:</strong> Balance y l√≠mites informan reglas para registrar nuevas transacciones.</li>
            <li><strong>UI (Material-UI):</strong> TextField, Grid, Card y Snackbar estandarizados.</li>
        </ul>
    </section>

    <section class="section">
        <h2>üåê APIs P√∫blicas</h2>
        <div class="card">
            <h3>GET /api/account/acccount?accountId={id}</h3>
            <p>Retorna cuenta completa (balance, l√≠mite, tarjetas, cliente con SSN enmascarado). `accountId` obligatorio de 11 d√≠gitos.</p>
            <pre><code>{
  "accountId": "11111111111",
  "status": "Y",
  "balance": 1250.75,
  "creditLimit": 5000.00,
  "availableCredit": 3749.25,
  "customer": { "customerId": "1000000001", "firstName": "JOHN", "ssn": "***-**-6789" },
  "cards": [{ "cardNumber": "****-****-****-1111", "status": "ACTIVE" }]
}</code></pre>
        </div>
        <div class="card">
            <h3>PUT /api/account/update</h3>
            <p>Actualiza account y customer en una sola transacci√≥n. Valida reglas antes de persistir y retorna mensaje de √©xito.</p>
            <pre><code>{
  "accountId": "11111111111",
  "customer": {
    "address": { "addressLine1": "456 NEW STREET", "zipCode": "10002" },
    "phones": [{ "phoneType": "MOBILE", "phoneNumber": "(555) 987-6543" }]
  }
}</code></pre>
            <p><strong>Response:</strong> <code>{ "success": true, "message": "Account updated successfully" }</code></p>
        </div>
    </section>

    <section class="section">
        <h2>üìä Modelos y Reglas</h2>
        <table>
            <thead>
                <tr><th>Entidad</th><th>Campos clave</th><th>Restricciones</th></tr>
            </thead>
            <tbody>
                <tr>
                    <td>Account</td>
                    <td>accountId (11 d√≠gitos), balance, creditLimit, availableCredit, status (Y/N)</td>
                    <td>accountId regex <code>^\d{11}$</code>, status solo Y o N, `availableCredit` = creditLimit - balance.</td>
                </tr>
                <tr>
                    <td>Customer</td>
                    <td>customerId, firstName/lastName, ssn (masked), ficoScore 300-850, address, phones</td>
                    <td>SSN enmascarado, ZIP regex <code>^\d{5}(-\d{4})?$</code>, FICO en rango.</td>
                </tr>
            </tbody>
        </table>
        <div class="grid" style="margin-top: 20px;">
            <div class="card">
                <h3>RN-001</h3>
                <p>Account ID debe ser de 11 d√≠gitos y no puede ser cero puro.</p>
            </div>
            <div class="card">
                <h3>RN-006</h3>
                <p>SSN y tarjetas se muestran enmascarados (***-**-XXXX / ****-****-****-XXXX).</p>
            </div>
            <div class="card">
                <h3>RN-018</h3>
                <p>Actualizaci√≥n de Account/Customer es at√≥mica; fallos disparan rollback.</p>
            </div>
        </div>
    </section>

    <footer>
        <p><a href="../index.html">‚Üê Volver al √çndice de M√≥dulos</a> ¬∑ <a href="../../system-overview.md">üè† System Overview</a></p>
        <p><em>√öltima actualizaci√≥n: 2026-01-28 | Precisi√≥n: ‚â•95%</em></p>
    </footer>
</div>
</body>
</html>
